order: 1
id: powerpoint-text-get-set-textrange
name: Work with text range selections
description: Get, set, load, and save text range selections.
host: POWERPOINT
api_set:
    PowerPointApi: '1.8'
script:
    content: |
        document.getElementById("getSelectedTextRange").addEventListener("click", () => tryCatch(getSelectedTextRange));
        document.getElementById("setSelectedTextRange").addEventListener("click", () => tryCatch(setSelectedTextRange));
        document.getElementById("changeColor").addEventListener("click", () => tryCatch(changeColor));
        document.getElementById("saveTextSelection").addEventListener("click", () => tryCatch(saveTextSelection));
        document.getElementById("loadTextSelection").addEventListener("click", () => tryCatch(loadTextSelection));
        document
          .getElementById("getSelectedTextRangeProperties")
          .addEventListener("click", () => tryCatch(getSelectedTextRangeComplexProperties));

        async function getSelectedTextRange() {
          // Gets the selected text range and prints data about the range on the task pane.
          await PowerPoint.run(async (context) => {
            const textRange: PowerPoint.TextRange = context.presentation.getSelectedTextRange();
            try {
              await context.sync();
            } catch (error) {
              console.warn("You must select only one range of text for this action to work.");
              return;
            }
            textRange.load("text");
            textRange.load("start");
            textRange.load("length");
            await context.sync();
            let txtHtml = textRange.text;
            txtHtml = txtHtml.replace(/\n/g, "<br>");
            txtHtml = txtHtml.replace(/\r/g, "<br>");
            txtHtml = txtHtml.replace(/\v/g, "<br>");
            let txtExplained = textRange.text;
            txtExplained = txtExplained.replace(/\n/g, "<font color=red>NL</font>");
            txtExplained = txtExplained.replace(/\r/g, "<font color=red>CR</font>");
            txtExplained = txtExplained.replace(/\v/g, "<font color=red>VV</font>");
            let finalTable = "";
            finalTable +=
              "<table border=1 cellpadding=3 cellspacing=0><tr><td bgcolor=#3333EE><font color=white>Index</font></td><td bgcolor=#3333EE><font color=white>Id</font></td></tr>";
            finalTable += "<tr><td>Raw</td><td>" + textRange.text + "</td></tr>";
            finalTable += "<tr><td>Html</td><td>" + txtHtml + "</td></tr>";
            finalTable += "<tr><td>Exp</td><td>" + txtExplained + "</td></tr>";
            finalTable += "<tr><td>Start</td><td>" + textRange.start + "</td></tr>";
            finalTable += "<tr><td>Length</td><td>" + textRange.length + "</td></tr>";
            finalTable += "</table>";
            const outputSpan = document.getElementById("outputSpan");
            outputSpan.innerHTML = "";
            outputSpan.innerHTML += finalTable;
          });
        }

        async function setSelectedTextRange() {
          // Selects the first 10 characters of the selected shape.
          await PowerPoint.run(async (context) => {
            const shapes: PowerPoint.ShapeScopedCollection = context.presentation.getSelectedShapes();
            const shapeCount = shapes.getCount();
            await context.sync();
            if (shapeCount.value !== 1) {
              console.warn("You must select only one shape with text in it.");
              return;
            }
            const shape: PowerPoint.Shape = shapes.getItemAt(0);
            const textFrame: PowerPoint.TextFrame = shape.textFrame.load("textRange,hasText");
            await context.sync();
            if (textFrame.hasText != true) {
              console.warn("You must select only one shape with text in it.");
              return;
            }
            const textRange: PowerPoint.TextRange = textFrame.textRange;
            textRange.load("text");
            await context.sync();
            if (textRange.text.length < 10) {
              console.warn("You must select only one shape with at least 10 characters in it.");
              return;
            }
            const textRange10 = textRange.getSubstring(0, 10);
            textRange10.setSelected();
            await context.sync();
          });
        }

        async function changeColor() {
          // Sets the color of the selected text range to green.
          await PowerPoint.run(async (context) => {
            const textRange: PowerPoint.TextRange = context.presentation.getSelectedTextRange();
            textRange.font.color = "green";
            await context.sync();
          });
        }

        let savedTextSlideSelection = [];
        let savedTextShapeSelection = [];
        let savedTextTextRangeStart;
        let savedTextTextRangeLength;
        async function saveTextSelection() {
          // Saves the range that is currently selected so it can be reselected later.
          await PowerPoint.run(async (context) => {
            let finalTable = "";
            context.presentation.load("slides");
            await context.sync();
            const slides: PowerPoint.SlideScopedCollection = context.presentation.getSelectedSlides();
            const slideCount = slides.getCount();
            slides.load("items");
            await context.sync();
            savedTextSlideSelection = [];
            slides.items.map((slide) => {
              savedTextSlideSelection.push(slide.id);
            });

            const shapes: PowerPoint.ShapeScopedCollection = context.presentation.getSelectedShapes();
            shapes.load("items");
            await context.sync();
            savedTextShapeSelection = [];
            shapes.items.map((shape) => {
              savedTextShapeSelection.push(shape.id);
            });
            const savedTextRange: PowerPoint.TextRange = context.presentation.getSelectedTextRangeOrNullObject();
            savedTextRange.load("start,length");
            await context.sync();
            if (savedTextRange.isNullObject) {
              console.warn("You must select only one shape with text in it.");
              return;
            }
            savedTextTextRangeStart = savedTextRange.start;
            savedTextTextRangeLength = savedTextRange.length;
          });
        }

        async function loadTextSelection() {
          // Sets the range selection to the range that was saved previously.
          await PowerPoint.run(async (context) => {
            const slide1: PowerPoint.Slide = context.presentation.slides.getItem(savedTextSlideSelection[0]);
            const shape1: PowerPoint.Shape = slide1.shapes.getItem(savedTextShapeSelection[0]);
            const textRange: PowerPoint.TextRange = shape1.textFrame.textRange.getSubstring(
              savedTextTextRangeStart,
              savedTextTextRangeLength,
            );
            textRange.setSelected();
            await context.sync();
          });
        }

        async function getSelectedTextRangeComplexProperties() {
          // Gets navigational (complex) properties of the selected text range.
          await PowerPoint.run(async (context) => {
            const textRange: PowerPoint.TextRange = context.presentation.getSelectedTextRange();
            textRange.load("font,paragraphFormat/bulletFormat,paragraphFormat/horizontalAlignment");
            await context.sync();

            console.log("Font properties of selected text range:");
            console.log(`\tallCaps: ${textRange.font.allCaps}`);
            console.log(`\tbold: ${textRange.font.bold}`);
            console.log(`\tcolor: ${textRange.font.color}`);
            console.log(`\tdoubleStrikethrough: ${textRange.font.doubleStrikethrough}`);
            console.log(`\titalic: ${textRange.font.italic}`);
            console.log(`\tname: ${textRange.font.name}`);
            console.log(`\tsize: ${textRange.font.size}`);
            console.log(`\tsmallCaps: ${textRange.font.smallCaps}`);
            console.log(`\tstrikethrough: ${textRange.font.strikethrough}`);
            console.log(`\tsubscript: ${textRange.font.subscript}`);
            console.log(`\tsuperscript: ${textRange.font.superscript}`);
            console.log(`\tunderline: ${textRange.font.underline}`);

            console.log("Paragraph format properties of selected text range:");
            console.log(`\tbulletFormat.visible: ${textRange.paragraphFormat.bulletFormat.visible}`);
            console.log(`\thorizontalAlignment: ${textRange.paragraphFormat.horizontalAlignment}`);
          });
        }

        /** Default helper for invoking an action and handling errors. */
        async function tryCatch(callback) {
          try {
            await callback();
          } catch (error) {
            // Note: In a production add-in, you'd want to notify the user through your add-in's UI.
            console.error(error);
          }
        }
    language: typescript
template:
    content: |-
        <section>
            <p>This sample shows how to get selected text, and how to select specific text.</p>
        </section>
        <section>
            <h3>Try it out</h3>
            <p>Before choosing the <b>Get selected text range</b> button, add text to a slide and select some text.</p>
            <button id="getSelectedTextRange">Get selected text range</button>
            <button id="setSelectedTextRange">Select first 10 characters of selected shape</button>
            <button id="changeColor">Change color of selected text</button>
            <button id="saveTextSelection">Save text selection</button>
            <button id="loadTextSelection">Load the saved selection</button>
            <button id="getSelectedTextRangeProperties">Get selected text range properties</button>
            <h4>Output</h4>
            <span id="outputSpan"></span>
            <p>Output from choosing the <b>Get selected text range</b> button is displayed in this section.</p>
        </section>
    language: html
style:
    content: |-
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            padding: 10px;
        }

        section {
            margin-bottom: 20px;
        }

        h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }

        p {
            margin: 0 0 10px 0;
        }

        button {
            background-color: #f0f0f0;
            color: #333333;
            border: 1px solid #8a8a8a;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 2px;
            margin-left: 20px;
            margin-bottom: 5px;
            min-width: 80px;
            display: block;
        }

        button:hover {
            background-color: #e0e0e0;
        }

        button:active {
            background-color: #d0d0d0;
        }

        input {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 2px;
            font-size: 14px;
        }

        .header {
            text-align: center;
            background-color: #f3f2f1;
            padding: 10px;
        }
    language: css
libraries: |-
    https://appsforoffice.microsoft.com/lib/1/hosted/office.js
    https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js/index.d.ts
order: 6
id: excel-data-types-entity-attribution
name: 'Data types: Entity card attributions and layout types'
description: Set data provider attributions on entity values and use different card layout types including list, two-column, and table.
host: EXCEL
api_set:
    ExcelApi: '1.19'
script:
    content: |-
        document.getElementById("setup").addEventListener("click", () => tryCatch(setup));
        document.getElementById("add-entities-to-table").addEventListener("click", () => tryCatch(addEntitiesToTable));

        async function addEntitiesToTable() {
          // Retrieve product data from the table, create entity values,
          // and add the entities to the table.
          await Excel.run(async (context) => {
            const productsTable = context.workbook.tables.getItem("ProductsTable");

            // Add a new column to the table for the entity values.
            productsTable.columns.getItemOrNullObject("Product").delete();
            const productColumn = productsTable.columns.add(0, null, "Product");

            // Get product data from the table.
            const dataRange = productsTable.getDataBodyRange();
            dataRange.load("values");

            await context.sync();

            // Create entities from the table data.
            const entities = dataRange.values.map((rowValues) => {
              // Get the product data.
              const product = getProduct(rowValues[1]);

              // Create an entity with table data and JSON data.
              return [makeProductEntity(rowValues[1], rowValues[2], product)];
            });

            // Add the complete entities to the Products Table.
            productColumn.getDataBodyRange().valuesAsJson = entities;

            productColumn.getRange().format.autofitColumns();
            await context.sync();
          });
        }

        // Create entities with card layout and data provider fields. 
        function makeProductEntity(productID: number, productName: string, product?: any) {
          const entity: Excel.EntityCellValue = {
            type: Excel.CellValueType.entity,
            text: productName,
            properties: { /* Excel.EntityPropertyType */
              "Product ID": {
                type: Excel.CellValueType.string,
                basicValue: productID.toString() || ""
              },
              "Product Name": {
                type: Excel.CellValueType.string,
                basicValue: productName || ""
              },
              "Quantity Per Unit": {
                type: Excel.CellValueType.string,
                basicValue: product.quantityPerUnit || ""
              },
              // Add Unit Price as a formatted number.
              "Unit Price": {
                type: Excel.CellValueType.formattedNumber,
                basicValue: product.unitPrice,
                numberFormat: "$* #,##0.00"
              },
              "Units In Stock": {
                type: Excel.CellValueType.double,
                basicValue: product.unitsInStock
              },
              "Units On Order": {
                type: Excel.CellValueType.double,
                basicValue: product.unitsOnOrder
              },
              "Reorder Level": {
                type: Excel.CellValueType.double,
                basicValue: product.reorderLevel
              }
            },
            layouts: { /* Excel.EntityViewLayouts */
              card: { /* Excel.EntityCardLayout */
                title: { property: "Product Name" },
                sections: [ /* Excel.CardLayoutSection */
                  {
                    layout: "List",
                    properties: ["Product ID"]
                  },
                  {
                    layout: "TwoColumn", /* Excel.CardLayoutTwoColumnSection */
                    title: "Quantity and price",
                    collapsible: true,
                    collapsed: false,
                    properties: ["Quantity Per Unit", "Unit Price"]
                  },
                  {
                    layout: "Table", /* Excel.CardLayoutTableSection */
                    title: "Stock information",
                    collapsible: true,
                    collapsed: false,
                    properties: ["Units In Stock", "Units On Order", "Reorder Level"]
                  }
                ]
              }
            },
            provider: {
              description: product.providerName, // Name of the data provider. Displays as a tooltip when hovering over the logo. Also displays as a fallback if the source address for the image is broken.
              logoSourceAddress: product.sourceAddress, // Source URL of the logo.
              logoTargetAddress: product.targetAddress // URL to open when you select the logo.
            }
          };

          return entity;
        }

        // Get a product by its ID.
        function getProduct(productID: number): any {
          return products.find((p) => p.productID == productID);
        }

        /** Set up the Sample worksheet. */ 
        async function setup() {
          await Excel.run(async (context) => {
            context.workbook.worksheets.getItemOrNullObject("Sample").delete();
            const sheet = context.workbook.worksheets.add("Sample");

            const productsTable = sheet.tables.add("A1:C1", true /*hasHeaders*/);
            productsTable.name = "ProductsTable";

            productsTable.getHeaderRowRange().values = [["Product", "ProductID", "ProductName"]];

            productsTable.rows.add(
              null /*add at the end*/,
              products.map((p) => [null, p.productID, p.productName])
            );

            sheet.getUsedRange().format.autofitColumns();
            sheet.getUsedRange().format.autofitRows();

            sheet.activate();

            await context.sync();
          });
        }

        /** Helper function to invoke an action and handle errors. */ 
        async function tryCatch(callback) {
          try {
            await callback();
          } catch (error) {
            // Note: In a production add-in, you'd want to notify the user through your add-in's UI.
            console.error(error);
          }
        }

        /** Sample JSON product data. */
        const products = [
          {
            productID: 1,
            productName: "Chai",
            quantityPerUnit: "10 boxes x 20 bags",
            unitPrice: 18,
            unitsInStock: 39,
            unitsOnOrder: 0,
            reorderLevel: 10,
            providerName: "Microsoft",
            sourceAddress: "https://github.com/OfficeDev/office-js-snippets/blob/main/.github/images/microsoft-logo.png?raw=true",
            targetAddress: "http://microsoft.com"
          },
          {
            productID: 2,
            productName: "Chang",
            quantityPerUnit: "24 - 12 oz bottles",
            unitPrice: 19,
            unitsInStock: 17,
            unitsOnOrder: 40,
            reorderLevel: 25,
            providerName: "MSN",
            sourceAddress: "https://github.com/OfficeDev/office-js-snippets/blob/main/.github/images/msn-logo.png?raw=true",
            targetAddress: "http://msn.com"
          },
          {
            productID: 3,
            productName: "Aniseed Syrup",
            quantityPerUnit: "12 - 550 ml bottles",
            unitPrice: 10,
            unitsInStock: 13,
            unitsOnOrder: 70,
            reorderLevel: 25,
            providerName: "Xbox",
            sourceAddress: "https://github.com/OfficeDev/office-js-snippets/blob/main/.github/images/xbox-logo.png?raw=true",
            targetAddress: "http://xbox.com"
          },
          {
            productID: 4,
            productName: "Chef Anton's Cajun Seasoning",
            quantityPerUnit: "48 - 6 oz jars",
            unitPrice: 22,
            unitsInStock: 53,
            unitsOnOrder: 0,
            reorderLevel: 0,
            providerName: "Microsoft",
            sourceAddress: "https://github.com/OfficeDev/office-js-snippets/blob/main/.github/images/microsoft-logo.png?raw=true",
            targetAddress: "http://microsoft.com"
          },
          {
            productID: 5,
            productName: "Chef Anton's Gumbo Mix",
            quantityPerUnit: "36 boxes",
            unitPrice: 21.35,
            unitsInStock: 0,
            unitsOnOrder: 0,
            reorderLevel: 0,
            providerName: "MSN",
            sourceAddress: "https://github.com/OfficeDev/office-js-snippets/blob/main/.github/images/msn-logo.png?raw=true",
            targetAddress: "http://msn.com"
          },
        ];
    language: typescript
template:
    content: |-
        <section>
          <p>This sample sets data provider attributions on entity values and uses different card layout types. The data comes from three different data providers.</p>
          <p>The entity card uses three layout types:</p>
          <ul>
            <li><strong>List</strong>: Shows the Product ID.</li>
            <li><strong>Two-column</strong>: Shows quantity and price side by side.</li>
            <li><strong>Table</strong>: Shows stock information in a table.</li>
          </ul>
        </section>
        <section class="setup">
          <h3>Set up</h3>
          <button id="setup">Create table</button>
        </section>
        <section>
          <h3>Try it out</h3>
          <button id="add-entities-to-table">Add entity values</button>
          <p>After you select <strong>Add entity values</strong>, select the icon to the left of a title in the <strong>Product</strong> column to see the data attribution.</p>
          <p>A logo appears in the bottom-left corner of the entity card. Hover over the logo to see the data provider name. Select the logo to visit the data provider URL.</p>
        </section>
    language: html
style:
    content: |-
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            padding: 10px;
        }

        section {
            margin-bottom: 20px;
        }

        h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }

        p {
            margin: 0 0 10px 0;
        }

        button {
            background-color: #f0f0f0;
            color: #333333;
            border: 1px solid #8a8a8a;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 2px;
            margin-left: 20px;
            margin-bottom: 5px;
            min-width: 80px;
            display: block;
        }

        button:hover {
            background-color: #e0e0e0;
        }

        button:active {
            background-color: #d0d0d0;
        }

        input {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 2px;
            font-size: 14px;
        }

        .header {
            text-align: center;
            background-color: #f3f2f1;
            padding: 10px;
        }
    language: css
libraries: |-
    https://appsforoffice.microsoft.com/lib/1/hosted/office.js
    https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js/index.d.ts
id: outlook-attachments-attachments-compose
name: Manipulate attachments (Item Compose)
description: Adds, gets, and removes attachments from a message or an appointment in Compose mode.
host: OUTLOOK
api_set:
    Mailbox: '1.8'
script:
    content: |-
        document.getElementById("add").addEventListener("click", add);
        document.getElementById("addBase64").addEventListener("click", addBase64);
        document.getElementById("get").addEventListener("click", get);
        document.getElementById("remove").addEventListener("click", remove);

        function add() {
          const attachmentUrl = (document.getElementById("attachmentUrl") as HTMLInputElement).value;
          Office.context.mailbox.item.addFileAttachmentAsync(
            attachmentUrl,
            getFileName(attachmentUrl),
            { isInline: false },
            (result) => {
              console.log(result);
            }
          );
        }

        function addBase64() {
          const base64String = "iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAACRUlEQVRYw82XzXHbMBCFP2F8tzsQc8Ixyh0zoiuIXIGdCsxUYKqC0B04FdiuwMoM7mGOOIXqQGoAymXhgSX+itJM9kIRFLAP+3YXD5Pdbscx5oxaAIW8Ztr6l2PWmQwF4IyaieP53qdfAqQ8CwBn1JU4vpWhrbxXQA5MZfynANmcDIAzKgcy4FKGXsVJFf3nLgKyBQptfT4KQMRz2N0fcbxqmRMDWXflx0VPnrdArq0vekQ1Dv0UeHZGNebHhwjU8AzwKM43RyZnbAf58Q6ghudeWd0Aus0+5EcMIIRi3beua0D3Nm39BEAx3i7HTK4DEBJn5YxKOnaRA5+ErpMBWMpzDvx1RuXCcxOISlufAjfC7zgAsqsvUvMAD0ApPaEtGi9AIlUzKgJo60tt/SyKRkzLrAXERluf7W1gOICWaMyB386oooOWsIHvXbSoHuUSFovtHqicUVnH3EJoeT0aQEf5/XBGlc6otIOWBXAtPeZkAIJ9Bt6cUU9tZautX2nrk3MACHYr1ZKProKRtDw4o8pzAPjWo+NtpXTTvoteDDg8noDAcwbcRedAkGdFXyk2GEDcegVAFp2gyVDHjRQ4o6q2smoqtR5Hd+qMqtoALCWUUymr1m43QMZfOaMK4C0SrMsDANJ2E5FNcbdbjHC+ENl+H0myJFbLtaq4Rt8dyPBYRQV1E40nMv9rl7xrOw3DGb+Whcqu3i/OM6CUOWvgRlufNmnLYy4m77uJI7AXtdNcTDrU71LEyv7v01/N/ovL6bmu5/8A1tNWZldH0W4AAAAASUVORK5CYII=";
          Office.context.mailbox.item.addFileAttachmentFromBase64Async(
            base64String,
            "logo.png",
            { isInline: false },
            (result) => {
              console.log(result);
            }
          );
        }

        function get() {
          Office.context.mailbox.item.getAttachmentsAsync((result) => {
            if (result.status === Office.AsyncResultStatus.Failed) {
              console.error(result.error.message);
              return;
            }

            if (result.value.length > 0) {
              for (let i = 0; i < result.value.length; i++) {
                const attachment = result.value[i];
                let attachmentType;
                switch (attachment.attachmentType) {
                  case Office.MailboxEnums.AttachmentType.Cloud:
                    attachmentType="Attachment is stored in a cloud location";
                    break;
                  case Office.MailboxEnums.AttachmentType.File:
                    attachmentType="Attachment is a file";
                    break;
                  case Office.MailboxEnums.AttachmentType.Item:
                    attachmentType="Attachment is an Exchange item";
                    break;
                }
                console.log(
                  "ID: " +
                    attachment.id +
                    "\n" +
                    "Type: " +
                    attachmentType +
                    "\n" +
                    "Name: " +
                    attachment.name +
                    "\n" +
                    "Size: " +
                    attachment.size +
                    "\n" +
                    "isInline: " +
                    attachment.isInline
                );
              }
            } else {
              console.log("No attachments on this message.");
            }
          });
        }

        function remove() {
          Office.context.mailbox.item.removeAttachmentAsync(
            (document.getElementById("attachmentId") as HTMLInputElement).value,
            (result) => {
              if (result.status === Office.AsyncResultStatus.Failed) {
                console.error(result.error.message);
                return;
              }

              console.log(`Attachment removed successfully.`);
            }
          );
        }

        function getFileName(url) {
          const lastIndex = url.lastIndexOf("/");
          if (lastIndex >= 0) {
            return url.substring(lastIndex + 1);
          }
          return url;
        }
    language: typescript
template:
    content: |-
        <section>
            <p>This sample shows how to add, get, and remove attachments from a message or an appointment in Compose mode.</p>
            <p><b>Required mode</b>: Item Compose</p>
        </section>
        <section>
            <h3>Try it out</h3>
            <hr>
            <h4>ADD</h4>
            <button id="addBase64" >
                <div>Add attachment from Base64</div>
            </button>
            <label>URL of attachment to add:</label>
            <input id="attachmentUrl" type="text" value="https://i.imgur.com/9S36xvA.jpg" placeholder="">
                <button id="add" >
            <div>Add attachment</div>
          </button>
                <hr>
                <h4>GET</h4>
                <button id="get" >
            <div>Get attachments</div>
          </button>
                <hr>
                <h4>REMOVE</h4>
                <label>ID of attachment to remove:</label>
                <input id="attachmentId" type="text" value="0" placeholder="">
                <button id="remove">Remove attachment</button>
        </section>
    language: html
style:
    content: |-
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            padding: 10px;
        }

        section {
            margin-bottom: 20px;
        }

        h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }

        p {
            margin: 0 0 10px 0;
        }

        button {
            background-color: #0078d4;
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 2px;
            margin-left: 20px;
            margin-bottom: 5px;
            min-width: 80px;
            display: block;
        }

        button:hover {
            background-color: #106ebe;
        }

        button:active {
            background-color: #005a9e;
        }

        input {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 2px;
            font-size: 14px;
        }

        .header {
            text-align: center;
            background-color: #f3f2f1;
            padding: 10px;
        }
    language: css
libraries: |-
    https://appsforoffice.microsoft.com/lib/1/hosted/office.js
    https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js/index.d.ts
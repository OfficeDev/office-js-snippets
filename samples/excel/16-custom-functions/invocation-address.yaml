order: 4
id: excel-custom-functions-invocation-address
name: Invocation address sample
description: Reference the custom function's cell location to adjust behavior.
host: EXCEL
api_set:
    CustomFunctionsRuntime: 1.5
script:
    content: |
        /**
         * Returns the localized price for an item, based on the worksheet name of the calling cell.
         * 
         * To use this sample, create worksheets named "EU", "APAC" and "US", 
         * and then call the custom function with the "SKU-001" or "SKU-002" item ID 
         * from each worksheet to see price variations. 
         * The sample shows how the worksheet name is used in the function invocation to return specific outputs.
         * 
         * @customfunction
         * @param {string} itemId The item identifier. Must be "SKU-001" or "SKU-002" for this example.
         * @param {CustomFunctions.Invocation} invocation Information about the invocation of the custom function.
         * @requiresAddress
         */
        async function skuPriceLookup(itemId: string, invocation: CustomFunctions.Invocation): Promise<number> {
          // The function assumes worksheets are named based on the local market.
          // In this example, there are "EU", "APAC", and "US" worksheets.
          // The invocation address is in the form "WorksheetName!CellAddress".
          const address = invocation.address;
          const sheetName = address.split("!")[0];

          // Look up a base price from a service or cache.
          const base = await getBasePrice(itemId);

          // Apply market-specific adjustments.
          switch (sheetName) {
            case "EU": return base * 1.20;
            case "APAC": return base * 1.10;
            case "US": return base * 1.07;
            default:
              console.warn(`PRICE was called from unexpected sheet "${sheetName}" at address "${address}". Returning base price without market adjustment.`);
              return base;
          }
        }

        // An example price catalog lookup function.
        // This would be replaced with your service.
        async function getBasePrice(itemId: string): Promise<number> {
          const catalog: Record<string, number> = { "SKU-001": 19.99, "SKU-002": 49.99 };
          const price = catalog[itemId];
          if (price === undefined) {
            throw new Error(`Unknown item ID: ${itemId}`);
          }
          return price;
        }
    language: typescript
libraries: |
    https://appsforoffice.microsoft.com/lib/1/hosted/office.js
    https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js/index.d.ts
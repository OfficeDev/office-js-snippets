order: 5
id: word-document-manage-tracked-changes
name: Manage tracked changes
description: This samples shows how to manage tracked changes, including accepting and rejecting changes.
host: WORD
api_set:
    WordApi: '1.6'
script:
    content: |-
        document.getElementById("get-all-tracked-changes").addEventListener("click", () => tryCatch(getAllTrackedChanges));
        document.getElementById("get-first-tracked-change-range").addEventListener("click", () => tryCatch(getFirstTrackedChangeRange));
        document.getElementById("get-next-tracked-change").addEventListener("click", () => tryCatch(getNextTrackedChange));
        document.getElementById("accept-first-tracked-change").addEventListener("click", () => tryCatch(acceptFirstTrackedChange));
        document.getElementById("reject-first-tracked-change").addEventListener("click", () => tryCatch(rejectFirstTrackedChange));
        document.getElementById("accept-all-tracked-changes").addEventListener("click", () => tryCatch(acceptAllTrackedChanges));
        document.getElementById("reject-all-tracked-changes").addEventListener("click", () => tryCatch(rejectAllTrackedChanges));
        document.getElementById("setup").addEventListener("click", () => tryCatch(setup));

        async function getAllTrackedChanges() {
          // Gets all tracked changes.
          await Word.run(async (context) => {
            const body: Word.Body = context.document.body;
            const trackedChanges: Word.TrackedChangeCollection = body.getTrackedChanges();
            trackedChanges.load();
            await context.sync();

            console.log(trackedChanges);
          });
        }

        async function getFirstTrackedChangeRange() {
          // Gets the range of the first tracked change.
          await Word.run(async (context) => {
            const body: Word.Body = context.document.body;
            const trackedChanges: Word.TrackedChangeCollection = body.getTrackedChanges();
            const trackedChange: Word.TrackedChange = trackedChanges.getFirst();
            await context.sync();

            const range: Word.Range = trackedChange.getRange();
            range.load();
            await context.sync();

            console.log("range.text: " + range.text);
          });
        }

        async function getNextTrackedChange() {
          // Gets the next (second) tracked change.
          await Word.run(async (context) => {
            const body: Word.Body = context.document.body;
            const trackedChanges: Word.TrackedChangeCollection = body.getTrackedChanges();
            await context.sync();

            const trackedChange: Word.TrackedChange = trackedChanges.getFirst();
            await context.sync();

            const nextTrackedChange: Word.TrackedChange = trackedChange.getNext();
            await context.sync();

            nextTrackedChange.load(["author", "date", "text", "type"]);
            await context.sync();

            console.log(nextTrackedChange);
          });
        }

        async function acceptFirstTrackedChange() {
          // Accepts the first tracked change.
          await Word.run(async (context) => {
            const body: Word.Body = context.document.body;
            const trackedChanges: Word.TrackedChangeCollection = body.getTrackedChanges();
            const trackedChange: Word.TrackedChange = trackedChanges.getFirst();
            trackedChange.load();
            await context.sync();

            console.log("First tracked change:", trackedChange);
            trackedChange.accept();
            console.log("Accepted the first tracked change.");
          });
        }

        async function rejectFirstTrackedChange() {
          // Rejects the first tracked change.
          await Word.run(async (context) => {
            const body: Word.Body = context.document.body;
            const trackedChanges: Word.TrackedChangeCollection = body.getTrackedChanges();
            const trackedChange: Word.TrackedChange = trackedChanges.getFirst();
            trackedChange.load();
            await context.sync();

            console.log("First tracked change:", trackedChange);
            trackedChange.reject();
            console.log("Rejected the first tracked change.");
          });
        }

        async function acceptAllTrackedChanges() {
          // Accepts all tracked changes.
          await Word.run(async (context) => {
            const body: Word.Body = context.document.body;
            const trackedChanges: Word.TrackedChangeCollection = body.getTrackedChanges();
            trackedChanges.acceptAll();
            console.log("Accepted all tracked changes.");
          });
        }

        async function rejectAllTrackedChanges() {
          // Rejects all tracked changes.
          await Word.run(async (context) => {
            const body: Word.Body = context.document.body;
            const trackedChanges: Word.TrackedChangeCollection = body.getTrackedChanges();
            trackedChanges.rejectAll();
            console.log("Rejected all tracked changes.");
          });
        }

        async function setup() {
          // Updates the text and sets the font color to red.
          await Word.run(async (context) => {
            context.document.changeTrackingMode = Word.ChangeTrackingMode.off;

            context.document.body.insertText("AAA BBB CCC DDD EEE FFF", "Replace");

            context.document.changeTrackingMode = Word.ChangeTrackingMode.trackAll;
            context.document.body
              .search("BBB")
              .getFirst()
              .insertText("WWW", "Replace");
            context.document.body
              .search("DDD ")
              .getFirst()
              .delete();
            context.document.body
              .search("FFF")
              .getFirst()
              .insertText("XXX ", "Start");
          });
        }

        // Default helper for invoking an action and handling errors.
        async function tryCatch(callback) {
          try {
            await callback();
          } catch (error) {
            // Note: In a production add-in, you'd want to notify the user through your add-in's UI.
            console.error(error);
          }
        }
    language: typescript
template:
    content: |-
        <section class = "description">
            This sample shows how to manage tracked changes.
        </section>
        <section class = "setup">
            <h3>Set up</h3>
            <button id = "setup" >Add sample text</button>
        </section>
        <section class = "samples">
            <h3>Try it out</h3>
            <button id = "get-all-tracked-changes" >Get all tracked changes</button>
            <button id = "get-first-tracked-change-range" >Get the first tracked change's range</button>
            <button id = "get-next-tracked-change" >Get the next tracked change</button>
            <button id = "accept-first-tracked-change" >Accept the first tracked change</button>
            <button id = "reject-first-tracked-change" >Reject the first tracked change</button>
        </section>
        <section class = "samples">
            <p>First, choose the <b>Add sample text</b> button.
                <button id = "accept-all-tracked-changes" >Accept all tracked changes</button>
            </p>
            <p>First, choose the <b>Add sample text</b> button.
                <button id = "reject-all-tracked-changes" >Reject all tracked changes</button>
            </p>
        </section>
    language: html
style:
    content: |-
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            padding: 10px;
        }

        section {
            margin-bottom: 20px;
        }

        h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }

        p {
            margin: 0 0 10px 0;
        }

        button {
            background-color: #0078d4;
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 2px;
            margin-left: 20px;
            margin-bottom: 5px;
            min-width: 80px;
            display: block;
        }

        button:hover {
            background-color: #106ebe;
        }

        button:active {
            background-color: #005a9e;
        }

        input {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 2px;
            font-size: 14px;
        }

        .header {
            text-align: center;
            background-color: #f3f2f1;
            padding: 10px;
        }
    language: css
libraries: |-
    https://appsforoffice.microsoft.com/lib/1/hosted/office.js
    https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js/index.d.ts
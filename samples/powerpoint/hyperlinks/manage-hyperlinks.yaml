id: powerpoint-hyperlinks-manage-hyperlinks
name: Manage hyperlinks
description: Gets and sets hyperlinks on a slide.
host: POWERPOINT
api_set:
    PowerPointApi: '1.10'
script:
    content: |
        document
          .getElementById("set-hyperlink-on-text-range")
          .addEventListener("click", () => tryCatch(setHyperlinkOnTextRange));
        document.getElementById("set-hyperlink-on-shape").addEventListener("click", () => tryCatch(setHyperlinkOnShape));
        document.getElementById("get-hyperlinks").addEventListener("click", () => tryCatch(getHyperlinks));
        document
          .getElementById("update-text-range-hyperlink")
          .addEventListener("click", () => tryCatch(updateHyperlinkOnTextRange));
        document.getElementById("update-shape-hyperlink").addEventListener("click", () => tryCatch(updateHyperlinkOnShape));
        document
          .getElementById("delete-text-range-hyperlink")
          .addEventListener("click", () => tryCatch(deleteHyperlinkFromTextRange));
        document.getElementById("delete-shape-hyperlink").addEventListener("click", () => tryCatch(deleteHyperlinkFromShape));
        document.getElementById("setup").addEventListener("click", () => tryCatch(setup));

        async function setHyperlinkOnTextRange() {
          // Sets a hyperlink on the selected text range.
          await PowerPoint.run(async (context) => {
            const slide: PowerPoint.Slide = context.presentation.getSelectedSlides().getItemAt(0);
            const textRange: PowerPoint.TextRange = context.presentation.getSelectedTextRange().load("text");
            const hyperlinks: PowerPoint.HyperlinkCollection = slide.hyperlinks;
            const hyperlinkAddOptions: PowerPoint.HyperlinkAddOptions = {
              address: "https://bing.com",
              screenTip: "Screen tip for text",
            };
            let hyperlink: PowerPoint.Hyperlink = hyperlinks.add(textRange, hyperlinkAddOptions).load("address,screenTip");
            try {
              await context.sync();
            } catch {
              console.warn(
                "Confirm that you have at least one slide and you've selected a contiguous range of text on the active slide.",
              );
              return;
            }

            console.log(
              `Added link "${hyperlink.address}" (screen tip: "${hyperlink.screenTip}") to the selected text "${textRange.text}".`,
            );
          });
        }

        async function setHyperlinkOnShape() {
          // Sets a hyperlink on the first selected shape.
          await PowerPoint.run(async (context) => {
            const slide: PowerPoint.Slide = context.presentation.getSelectedSlides().getItemAt(0);
            const shape: PowerPoint.Shape = context.presentation.getSelectedShapes().getItemAt(0).load("id,type");
            const hyperlinks: PowerPoint.HyperlinkCollection = slide.hyperlinks;
            const hyperlinkAddOptions: PowerPoint.HyperlinkAddOptions = {
              address: "https://bing.com",
              screenTip: "Screen tip for shape",
            };
            let hyperlink: PowerPoint.Hyperlink = hyperlinks.add(shape, hyperlinkAddOptions).load("address,screenTip");
            try {
              await context.sync();
            } catch {
              console.warn("Confirm that you have at least one slide and you've selected a shape on the active slide.");
              return;
            }

            console.log(
              `Added link "${hyperlink.address}" (screen tip: "${hyperlink.screenTip}") to the first selected shape (ID: ${shape.id}, type: ${shape.type}).`,
            );
          });
        }

        async function getHyperlinks() {
          // Gets the hyperlinks found in the first selected slide.
          await PowerPoint.run(async (context) => {
            const slide: PowerPoint.Slide = context.presentation.getSelectedSlides().getItemAt(0);
            const hyperlinks: PowerPoint.HyperlinkCollection = slide.hyperlinks.load("address,screenTip");
            const hyperlinksCount = hyperlinks.getCount();
            await context.sync();

            console.log(
              `${hyperlinksCount.value} hyperlinks found in first selected slide${hyperlinksCount.value === 0 ? "." : ":"}`,
            );
            for (let link of hyperlinks.items) {
              console.log(`Address: "${link.address}" (screen tip: "${link.screenTip}").`);
            }
          });
        }

        async function updateHyperlinkOnTextRange() {
          // Updates the first hyperlink found in the text range selection on the current slide.
          await PowerPoint.run(async (context) => {
            const textRange: PowerPoint.TextRange = context.presentation.getSelectedTextRange().load("text");
            let hyperlink: PowerPoint.Hyperlink = textRange.hyperlinks.getItemAt(0).load("address,screenTip");
            try {
              await context.sync();
            } catch {
              console.warn(
                "Confirm that you have at least one slide and you've selected a contiguous range of text containing at least one hyperlink on the active slide.",
              );
              return;
            }

            console.log(
              `About to update first link "${hyperlink.address}" (screen tip: "${hyperlink.screenTip}") found in the selected text "${textRange.text}"...`,
            );

            hyperlink.address = "https://www.microsoft.com";
            hyperlink.screenTip = "Updated screen tip of link on text range";

            console.log(
              `Updated first link found in the selected text "${textRange.text}" to "${hyperlink.address}" (screen tip: "${hyperlink.screenTip}").`,
            );
          });
        }

        async function updateHyperlinkOnShape() {
          // Updates the hyperlink on the first selected shape on the current slide.
          await PowerPoint.run(async (context) => {
            const shape: PowerPoint.Shape = context.presentation.getSelectedShapes().getItemAt(0).load("type");
            const hyperlinkAddOptions: PowerPoint.HyperlinkAddOptions = {
              address: "https://www.microsoft.com",
              screenTip: "Updated screen tip of link on shape",
            };
            const hyperlink: PowerPoint.Hyperlink = shape.setHyperlink(hyperlinkAddOptions).load("address,screenTip");
            try {
              await context.sync();
            } catch {
              console.warn("Confirm that you have at least one slide and you've selected a shape on the active slide.");
              return;
            }

            console.log(
              `Updated link on the selected ${shape.type} shape to "${hyperlink.address}" (screen tip: "${hyperlink.screenTip}").`,
            );
          });
        }

        async function deleteHyperlinkFromTextRange() {
          // Deletes the first hyperlink found in the selected text on the current slide.
          await PowerPoint.run(async (context) => {
            const textRange: PowerPoint.TextRange = context.presentation.getSelectedTextRange().load("text");
            let hyperlink: PowerPoint.Hyperlink = textRange.hyperlinks.getItemAt(0).load("address,screenTip");
            try {
              await context.sync();
            } catch {
              console.warn(
                "Confirm that you have at least one slide and you've selected a contiguous range of text containing at least one hyperlink on the active slide.",
              );
              return;
            }

            console.log(
              `About to delete first link "${hyperlink.address}" (screen tip: "${hyperlink.screenTip}") found in the selected text "${textRange.text}".`,
            );

            hyperlink.delete();

            console.log(`Deleted first link found in the selected text "${textRange.text}".`);
          });
        }

        async function deleteHyperlinkFromShape() {
          // Deletes the hyperlink from the first selected shape on the current slide.
          await PowerPoint.run(async (context) => {
            const shape: PowerPoint.Shape = context.presentation.getSelectedShapes().getItemAt(0).load("type");

            // Get an object representing the hyperlink on the selected shape. No need to set any properties since it's going to be deleted.
            const hyperlink: PowerPoint.Hyperlink = shape.setHyperlink();

            try {
              await context.sync();
            } catch {
              console.warn("Confirm that you have at least one slide and you've selected a shape on the active slide.");
              return;
            }

            console.log(
              `About to delete link from the selected ${shape.type} shape.`,
            );

            hyperlink.delete();

            console.log("Deleted link from the selected shape.");
          });
        }

        async function setup() {
          await PowerPoint.run(async (context) => {
            // Adds a new slide with two shapes.
            const slideCountResult = context.presentation.slides.getCount();
            context.presentation.slides.add();
            await context.sync();

            const newSlide = context.presentation.slides.getItemAt(slideCountResult.value);
            newSlide.load("id");

            // Create two shapes.
            const shape1 = newSlide.shapes.addGeometricShape(PowerPoint.GeometricShapeType.rectangle);
            shape1.left = 100;
            shape1.top = 100;
            shape1.width = 150;
            shape1.height = 100;
            shape1.fill.foregroundColor = "darkred";

            const shape2 = newSlide.shapes.addTextBox("Hello, world!", {
              left: 100,
              top: 300,
              height: 300,
              width: 450,
            });
            shape2.name = "Textbox for testing";

            await context.sync();

            console.log(`Added slide - ID: ${newSlide.id}`);

            // Switch to the new slide.
            context.presentation.setSelectedSlides([newSlide.id]);
            await context.sync();

            console.log(`Switched to the new slide - ID: ${newSlide.id}`);
          });
        }

        /** Default helper for invoking an action and handling errors. */
        async function tryCatch(callback) {
          try {
            await callback();
          } catch (error) {
            // Note: In a production add-in, you'd want to notify the user through your add-in's UI.
            console.error(error);
          }
        }
    language: typescript
template:
    content: |-
        <section>
            <p>Demonstrates how to get and set hyperlinks on a slide.</p>
        </section>
        <section class="setup">
            <h3>Set up</h3>
            <button id="setup">Set up</button>
        </section>
        <section>
            <h3>Try it out</h3>
            <p>Select text on the slide then click <b>Set hyperlink on text</b> button
                <button id="set-hyperlink-on-text-range">Set hyperlink on text</button>
            </p>
            <p>Select a shape on the slide then click <b>Set hyperlink on shape</b> button
                <button id="set-hyperlink-on-shape">Set hyperlink on shape</button>
            </p>
            <button id="get-hyperlinks">Get hyperlinks</button>
            <p>Select hyperlinked text on the slide then click <b>Update hyperlink on text</b> button
                <button id="update-text-range-hyperlink">Update hyperlink on text</button>
            </p>
            <p>Select hyperlinked shape on the slide then click <b>Update hyperlink on shape</b> button
                <button id="update-shape-hyperlink">Update hyperlink on shape</button>
            </p>
            <p>Select hyperlinked text on the slide then click <b>Delete hyperlink from text</b> button
                <button id="delete-text-range-hyperlink">Delete hyperlink from text</button>
            </p>
            <p>Select hyperlinked shape on the slide then click <b>Delete hyperlink from shape</b> button
                <button id="delete-shape-hyperlink">Delete hyperlink from shape</button>
                <p>
        </section>
    language: html
style:
    content: |-
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            padding: 10px;
        }

        section {
            margin-bottom: 20px;
        }

        h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }

        p {
            margin: 0 0 10px 0;
        }

        button {
            background-color: #f0f0f0;
            color: #333333;
            border: 1px solid #8a8a8a;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 2px;
            margin-left: 20px;
            margin-bottom: 5px;
            min-width: 80px;
            display: block;
        }

        button:hover {
            background-color: #e0e0e0;
        }

        button:active {
            background-color: #d0d0d0;
        }

        input {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 2px;
            font-size: 14px;
        }

        .header {
            text-align: center;
            background-color: #f3f2f1;
            padding: 10px;
        }
    language: css
libraries: |-
    https://appsforoffice.microsoft.com/lib/1/hosted/office.js
    https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js/index.d.ts
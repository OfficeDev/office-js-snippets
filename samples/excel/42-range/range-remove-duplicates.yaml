order: 11
id: excel-range-remove-duplicates
name: Remove duplicates
description: Removes duplicate entries from a range.
host: EXCEL
api_set:
    ExcelApi: '1.9'
script:
    content: |-
        document.getElementById("setup").addEventListener("click", () => tryCatch(setup));

        document.getElementById("delete-name").addEventListener("click", () => tryCatch(deleteName));
        document.getElementById("delete-distributor").addEventListener("click", () => tryCatch(deleteDistributor));

        async function deleteName() {
            await Excel.run(async (context) => {
                const sheet = context.workbook.worksheets.getItem("Sample");
                const range = sheet.getRange("B2:D11");

                const deleteResult = range.removeDuplicates([0],true);    
                deleteResult.load();    
                await context.sync();

                console.log(deleteResult.removed + " entries with duplicate names removed.");
                console.log(deleteResult.uniqueRemaining + " entries with unique names remain in the range.");
            });
        }

        async function deleteDistributor() {
            await Excel.run(async (context) => {
                const sheet = context.workbook.worksheets.getItem("Sample");
                const range = sheet.getRange("B2:D11");

                const deleteResult = range.removeDuplicates([1], true);
                deleteResult.load();
                await context.sync();

                console.log(deleteResult.removed + " entries with duplicate distributors removed.");
                console.log(deleteResult.uniqueRemaining + " entries with unique distributors remain in the range.");
            });
        }

        async function setup() {
            await Excel.run(async (context) => {
                context.workbook.worksheets.getItemOrNullObject("Sample").delete();
                const sheet = context.workbook.worksheets.add("Sample");

                const data = [
                    ["Product Name", "Distributor", "Order Amount"],
                    ["Onions", "Contoso Produce", 3],
                    ["Potatoes", "Contoso Produce", 9],
                    ["Red Wine", "Coho Vineyard", 7],
                    ["Onions", "Best For You Organics Company", 8],
                    ["Arugula", "Best For You Organics Company", 7],
                    ["Potatoes", "Contoso Produce", 12],
                    ["Red Wine", "Coho Vineyard", 3],
                    ["Onions", "Contoso Produce", 9],
                    ["Arugula", "Best For You Organics Company", 4]
                ];

                const range = sheet.getRange("B2:D11");
                range.values = data;
                range.format.autofitColumns();

                const header = range.getRow(0);
                header.format.fill.color = "#4472C4";
                header.format.font.color = "white";

                sheet.activate();

                await context.sync();
            });
        }

        /** Default helper for invoking an action and handling errors. */
        async function tryCatch(callback) {
            try {
                await callback();
            } catch (error) {
                // Note: In a production add-in, you'd want to notify the user through your add-in's UI.
                console.error(error);
            }
        }
    language: typescript
template:
    content: |-
        <section class="description">
            <p>This sample shows how to remove rows with duplicate column values from a range.</p>
        </section>
        <section class="setup">
            <h3>Set up</h3>
            <button id="setup" >Add sample data</button>
        </section>
        <section class="samples">
            <h3>Try it out</h3>
            <button id="delete-name" >Delete product name duplicates</button><p>
            <button id="delete-distributor" >Delete distributor duplicates</button><p>
            <p>Note that blank cells are considered in the remove duplicate checks. Since the duplicates are removed from the entire original range, the numbers logged to the console may be higher than expected.</p>
        </section>
    language: html
style:
    content: |-
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            padding: 10px;
        }

        section {
            margin-bottom: 20px;
        }

        h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }

        p {
            margin: 0 0 10px 0;
        }

        button {
            background-color: #0078d4;
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 2px;
            margin-left: 20px;
            margin-bottom: 5px;
            min-width: 80px;
            display: block;
        }

        button:hover {
            background-color: #106ebe;
        }

        button:active {
            background-color: #005a9e;
        }

        input {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 2px;
            font-size: 14px;
        }

        .header {
            text-align: center;
            background-color: #f3f2f1;
            padding: 10px;
        }
    language: css
libraries: |-
    https://appsforoffice.microsoft.com/lib/1/hosted/office.js
    https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js/index.d.ts